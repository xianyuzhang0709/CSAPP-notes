# Computer system A programmer's perspective

### 序1 - 梅宏（中科院院士）

重新审视我们原来参照**ACM/IEEE计算机专业计划的课程体系**，会发现存在以下几个方面的住哟啊问题：

1. 课程体系中缺乏一门贯穿整个计算机系统的基础课程。计算机基础知识被分为几门独立的课程，相互之间联系少。缺乏关联和系统性。
2. 现有课程偏重理论，实践少。我们会介绍函数调用过程中的**压栈退栈**方式，但是很少和实践关联，来理解压栈退栈过程的主要作用。实际上，压栈退栈与理解C等**高级语言的工作原理**息息相关，也是常用的攻击手段**Buffer Overflow**的主要技术基础。
3. 教学内容陈旧。现在的主流机是x86-64指令集，以及今年来出现的多核/众核处理器，SSD硬盘等实际应用中遇到的内容。
4. 课程大多数从设计者角度出发，而不是使用者的角度。设计专业的CPU、操作系统，不是大多数学生的出路，他们更多是毕业之后成为软件开发工程师。对于他们而言，**理解主流计算机系统的整体设计**以及**这些设计对于应用软件的开发和运行的影响**更为重要。

这本教材被作为北大计算机科学本科生教学改革的教材：

1. 该教材系统地介绍了计算机系统的工作原理。可以帮助学生系统地理解计算机如何执行程序、存储信息和通信。
2. 该教材实践强。配套9个实验，学生需要公婆计算机系统、设计CPU、实现命令行解释器、根据缓存优化程序等。在实验中理解系统原理，培养动手能力。
3. 该教材紧跟时代。加入了x86-64指令集、Intel Core i7的虚拟地址结构、SSD磁盘、IPv6等新技术。
4. 该教材从程序员角度看计算机系统，重点讨论系统的不同结构对上层应用软件的编写、执行和数据存储的影响。以培养程序员在更广阔的空间，应用计算机系统知识的能力。

该教材被用于“北大计算机系统导论”课程已5年。

学生通过这门课：

1. 建立了完整的计算机系统的知识体系和整体知识框架。
2. 养成了良好的编程习惯，并获得了编写高性能、可移植、健壮的程序的能力。
3. 奠定了后续学习操作系统、编译、计算机体系结构等专业课程的基础。

第三版对于第二版的改进和修订，在于：

1. 第三版一开始就采用最新的x86-64架构来贯穿各部分知识，
2. 在内存技术、网络技术上也有更新，
3. 重组了之前的一些比较难懂的内容。

> B站：《计算机科学导论》《算法导论》《哈尔滨工程大学：计算机及应用专业-计算机系统导论》《CSAPP》《操作系统导论》……
>
> 书和视频，搭配起来看。

### 序2 - 臧斌宇（上海交通大学软件学院）

* 本书2002年8月第一版首次印刷之后，一个月后我在复旦大学软件学院开设了“计算机系统基础”课程，成为国内第一个采用这本教材授课的老师。

本书的四个特点：

1. 涉及面广。覆盖二进制、汇编、组成、体系结构、操作系统、网络与并发程序设计等计算机系统最重要的方面。
2. 具有深度。本书从程序出发，逐步深入到系统领域的重要问题，而非点到为止。学完本书后读者可以很好地理解计算机系统的工作原理。
3. 面向低年级学生。本书通过合理的安排将计算机系统领域最核心的内容巧妙地展现给学生（例如，学生不需要掌握**逻辑设计**与**硬件描述语言**，就可以体验**处理器设计**）。
4. 配备实用有趣的实验。例如，模仿硬件仅用位操作完成复杂的运算，模仿tracker和hacker去破解密码以及攻击自身的程序，设计处理器，实现简单但功能强大的shell和proxy等。
   * 既强化了学生对本书知识的理解，又进一步激发了学生探究计算机系统的热情。

以低年级开设“深入理解计算机系统”课程为基础，我先后在负担和上交软件学院主导了激进的教学改革。

* 必修课时被大量压缩。现在的软工专业必修课由问题求解、计算机系统基础、应用开发基础、软件工程四个模块9们课构成。其他传统的必修课，如操作系统、编译原理、数字逻辑等都成为方向课。
* 课程体系的变化，减少了学生修读课程的总数和总课时，大幅度增加了实验总量、提高实验难度和强度、增强实验的综合性和创新性。
* 现在我的课题组青年教师都是首批经历此教学改革项目的学生。本科的扎实基础为他们从事**系统软件研究**打下了良好基础，他们实现了亚洲学术界在操作系统旗舰会议SOSP上论文发表0的突破，目前研究成果在国际上具有较大的影响力。师资的补充又为更全面推进更激进的教学改革创造了条件。

核心课程帮助学生构建专业知识框架，为学生在毕业后相当长的时间的专业发型奠定坚实基础。

一般认为，**问题抽象、系统抽象和数据抽象**是计算机类专业毕业生的核心能力。本书承担了系统抽象的重任，很多美国高校都采用该书作为计算机系统核心课程的教材。

2012年，北京大学计算机专业采用本书作为教材。

本书第三版的变化：

1. 完全按照x86-64系统进行改写。
2. 浮点指令以标量AVX2的形式加入，此内容在第二版中被删除，在第一版中的浮点指令以x87呈现。
3. 更加强调并发，增加了较大篇幅用于讨论信号处理程序与主程序间并发时的正确性保障。
4. 总体结构变化不大，不同的版本更多是为了在细节上能够反映技术的最新变化。

本书的缺点：

1. 对于初学者有些地方比较难读。
   * 本书中大量概念，第一次亮相时并没有编排好顺序。比如：寄存器的概念、汇编指令的执行模式、PC的概念等。
   * 这些介绍仅仅出现在第一章的总览中，而**第三章**介绍会变时也完全没有进一步展开就假设读者已经非常清楚这些概念。
   * 实际上这些概念，1介绍得过于简单，2短暂亮相之后又立即退场，3相隔时间较长后，又再次登场。
   * 第八章对进程、并发等概念的介绍也存在类似问题。
2. 中文翻译版配套了导读不能飞，希望这些导读可以帮助初学者顺利阅读。

### 译者序

第三版的组合方式：**在经典的x86架构机器上运行Linux操作系统，采用C语言编程**。

* 实验作业Lab Assignment（本书官网提供）
* 官方博客也不断更新关于本书和配套课程的最新变化

* 翻译：Memory，会根据语境去翻译为内存或存储器

### 前言

本书的主要读者：计算机科学家、计算机工程师、想要通过学习计算机系统的内在运作从而想写出更好程序的人。

本书的目的：解释所有计算机系统的本质概念，并向你展示这些概念是如何实实在在地影响应用程序的正确性、性能和实用性的。

* 其他系统类书籍都是从构建者的角度来写的，讲述如何实现硬件或系统软件，包括操作系统、编译器和网络接口。
* 本书从程序员角度来写，讲述应用程序员如何能够利用系统知识来编写出更好的程序。
* 学习”一个计算机系统应该做些什么“是学习”如何构建一个计算机系统“的很好的出发点，所以对于想继续学习系统软硬件实现的人来说，本书是一本很有价值的介绍性读物。
* 大部分书倾向于重点关注系统的某一方面：
  * 硬件架构
  * 操作系统
  * 编译器
  * 网络
  * 这本书则以程序员视角覆盖以上全部

本章概述：

* **第一章：计算机系统漫游。**一个简单程序的生命周期，介绍主要概念和主题。
* **第二章：信息的表示和处理。**
  * 计算机的算术运算
    * 无符号数和数的补码
    * 有符号和无符号之间的转换
    * C的位运算，布尔代数的原理和应用
    * 算数溢出：想表示x<y，不能用(x-y<0)因为可能会产生溢出，不能用(-y<-x)因为补码表示中负数和正数的范围是不对称的。
      * 算数溢出是造成程序错误和安全漏洞的一个常见根源。（计算机算数运算的特征）

* **第三章：程序的机器级表示。**
  * 如何阅读C编译器生成的x86-64机器代码。
  * 过程的实现，包括栈分配，寄存器使用惯例，参数传递
  * 不同的数据结构（结构、联合和数组）的分配和访问方式
  * 实现整数和浮点数算术运算的指令
  * 以分析程序的机器级的样子作为途径，来理解常见的代码安全漏洞（Buffer overflow 缓冲区溢出），以及理解程序员、编译器、操作系统可以采取的减轻这些威胁的措施
  * 加深对指针的了解
* **第四章：处理器体系结构。**
* **第五章：优化程序性能**
* **第六章：存储器层次结构**
* **第七章：链接**
* **第八章：异常控制流**
* **第九章：虚拟内存**
* **第十章：系统级I/O**
* **第十一章：网络编程**
* **第十二章：并发编程**

> 这部分不懂得词汇比较多，加英文注释，所有的图要有英文版，帮助理解原义